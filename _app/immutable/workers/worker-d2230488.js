(function(){"use strict";var r,T=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&T.decode();var y=null;function u(){return(y===null||y.byteLength===0)&&(y=new Uint8Array(r.memory.buffer)),y}function F(e,n){return e=e>>>0,T.decode(u().subarray(e,e+n))}var l=0;function k(e,n){const t=n(e.length*1,1)>>>0;return u().set(e,t/1),l=e.length,t}var m=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},C=typeof m.encodeInto=="function"?function(e,n){return m.encodeInto(e,n)}:function(e,n){const t=m.encode(e);return n.set(t),{read:e.length,written:t.length}};function g(e,n,t){if(t===void 0){const c=m.encode(e),_=n(c.length,1)>>>0;return u().subarray(_,_+c.length).set(c),l=c.length,_}let i=e.length,a=n(i,1)>>>0;const w=u();let s=0;for(;s<i;s++){const c=e.charCodeAt(s);if(c>127)break;w[a+s]=c}if(s!==i){s!==0&&(e=e.slice(s)),a=t(a,i,i=s+e.length*3,1)>>>0;const c=u().subarray(a+s,a+i),_=C(e,c);s+=_.written,a=t(a,i,s,1)>>>0}return l=s,a}function f(e){return e==null}function R(e){const n=r.__wbindgen_export_0.get(e);return r.__externref_table_dealloc(e),n}function S(e,n){return e=e>>>0,u().subarray(e/1,e/1+n)}var d=null;function E(){return(d===null||d.buffer.detached===!0||d.buffer.detached===void 0&&d.buffer!==r.memory.buffer)&&(d=new DataView(r.memory.buffer)),d}function p(e,n){e=e>>>0;const t=E(),i=[];for(let a=e;a<e+4*n;a+=4)i.push(r.__wbindgen_export_0.get(t.getUint32(a,!0)));return r.__externref_drop_slice(e,n),i}function D(e,n,t,i,a){var w=f(e)?0:g(e,r.__wbindgen_malloc,r.__wbindgen_realloc),s=l,c=f(n)?0:g(n,r.__wbindgen_malloc,r.__wbindgen_realloc),_=l,o=f(t)?0:g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),v=l,h=f(i)?0:g(i,r.__wbindgen_malloc,r.__wbindgen_realloc),b=l,$=f(a)?0:g(a,r.__wbindgen_malloc,r.__wbindgen_realloc),q=l;const B=r.createConverter(w,s,c,_,o,v,h,b,$,q);return z.__wrap(B)}var W=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_converter_free(e>>>0,1)),z=class{static __wrap(e){e=e>>>0;const n=Object.create(z.prototype);return n.__wbg_ptr=e,W.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,W.unregister(this),e}free(){const e=this.__destroy_into_raw();r.__wbg_converter_free(e,0)}registerFont(e){const n=k(e,r.__wbindgen_malloc),t=l;r.converter_registerFont(this.__wbg_ptr,n,t)}convert(e,n,t,i,a){const w=g(e,r.__wbindgen_malloc,r.__wbindgen_realloc),s=l;var c=f(a)?0:g(a,r.__wbindgen_malloc,r.__wbindgen_realloc),_=l;const o=r.converter_convert(this.__wbg_ptr,w,s,!f(n),f(n)?0:n,!f(t),f(t)?0:t,!f(i),f(i)?0:i,c,_);if(o[3])throw R(o[2]);var v=S(o[0],o[1]).slice();return r.__wbindgen_free(o[0],o[1]*1,1),v}list_fonts(){const e=r.converter_list_fonts(this.__wbg_ptr);var n=p(e[0],e[1]).slice();return r.__wbindgen_free(e[0],e[1]*4,4),n}};async function L(e,n){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,n)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await e.arrayBuffer();return await WebAssembly.instantiate(t,n)}else{const t=await WebAssembly.instantiate(e,n);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}}function U(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(n,t){return F(n,t)},e.wbg.__wbg_new_abda76e883ba8a5f=function(){return new Error},e.wbg.__wbg_stack_658279fe44541cf6=function(n,t){const i=t.stack,a=g(i,r.__wbindgen_malloc,r.__wbindgen_realloc),w=l;E().setInt32(n+4*1,w,!0),E().setInt32(n+4*0,a,!0)},e.wbg.__wbg_error_f851667af71bcfc6=function(n,t){let i,a;try{i=n,a=t,console.error(F(n,t))}finally{r.__wbindgen_free(i,a,1)}},e.wbg.__wbindgen_throw=function(n,t){throw new Error(F(n,t))},e.wbg.__wbindgen_init_externref_table=function(){const n=r.__wbindgen_export_0,t=n.grow(4);n.set(0,void 0),n.set(t+0,void 0),n.set(t+1,null),n.set(t+2,!0),n.set(t+3,!1)},e}function O(e,n){return r=e.exports,M.__wbindgen_wasm_module=n,d=null,y=null,r.__wbindgen_start(),r}async function M(e){if(r!==void 0)return r;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL("svg2png_wasm_bg.wasm",void 0));const n=U();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:i}=await L(await e,n);return O(t,i)}var I=M,A=!1,j=async e=>{if(A)throw new Error("Already initialized. The `initialize` function can be used only once.");await I(await e),A=!0},V=e=>{var i,a,w,s,c;if(!A)throw new Error("WASM has not been initialized. Call `initialize` function.");let n;n=D((i=e==null?void 0:e.defaultFontFamily)==null?void 0:i.serifFamily,(a=e==null?void 0:e.defaultFontFamily)==null?void 0:a.sansSerifFamily,(w=e==null?void 0:e.defaultFontFamily)==null?void 0:w.cursiveFamily,(s=e==null?void 0:e.defaultFontFamily)==null?void 0:s.fantasyFamily,(c=e==null?void 0:e.defaultFontFamily)==null?void 0:c.monospaceFamily);for(const _ of(e==null?void 0:e.fonts)??[])n.registerFont(_);const t=(_,o)=>new Promise((v,h)=>{try{const b=n==null?void 0:n.convert(_,o==null?void 0:o.scale,o==null?void 0:o.width,o==null?void 0:o.height,o==null?void 0:o.backgroundColor);if(b)v(b);else throw new Error("Converter already disposed.")}catch(b){b instanceof Error?h(b):h(new Error(`${b}`))}});return t.dispose=()=>{n==null||n.free(),n=void 0},t.getLoadedFontFamilies=()=>(n==null?void 0:n.list_fonts())??[],t};console.log("worker initializing");let x;self.addEventListener("message",e=>{const n=e.data;if(!(typeof n!="object"||n==null))switch(console.log(`worker ${n.type}`),n.type){case"initialize":j(n.wasm).then(()=>{x=V(n.options)});break;case"svg2png":x===void 0?self.postMessage({type:"error",error:"svg2png has not been initialized."}):x(n.svg,n.options).then(t=>self.postMessage({id:n.id,type:"success",data:t})).catch(t=>self.postMessage({id:n.id,type:"error",error:`${t}`}));break}})})();
